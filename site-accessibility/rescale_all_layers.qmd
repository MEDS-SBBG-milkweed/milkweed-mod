---
title: "Rescale all layers for accessibility index to 0-1"
date-created: 04-09-2024
date-last-updated: 04-09-2024
---

This document's purpose is to rescale all layers for our accessibility raster to a scale of 0-1 (0 = least accessible, 1 = most accessible) and set to same extent, CRS, and resolution.

# Set up

## Source Scripts
```{r}
source("../scripts/accessibility_setup.R")
```

### Read in Templates
```{r}
temp_rast <- read_stars(here::here("~/../../capstone/milkweedmod/data/models/allpoints_bioclim_canopy_dem.tif"))

temp_rast2 <- rast(temp_rast)
```

# Rescale Layers

## Canopy Cover
```{r}
min_max_cc <- minmax(canopy_cover) 
# (value - minimum_vale) / (maximum_value - minimum_value)
canopy_rescaled <- (canopy_cover - min_max_cc[1,]) / (min_max_cc[2,] - min_max_cc[1,])
plot(canopy_rescaled)
```

## Slope
```{r}
min_max_slope <- minmax(slope) 
# (value - minimum_vale) / (maximum_value - minimum_value)
slope_rescaled <- (slope - min_max_slope[1,]) / (min_max_slope[2,] - min_max_slope[1,])
plot(slope_rescaled)
```

## Distance from Trails
```{r}

```


## Distance from Roads
```{r}

```


## Land Ownership

For land ownership, we want a mask where 0 indicates private land and 1 indicates public land.

The data is a shape file with each row indicating geometry of public land, so I am first creating a column of 1s to indicate public land, then rasterizing using a template raster. 
```{r}
# make mask where 1 is public land and 0 is private land
lpnf_ownership_mask1 <- lpnf_ownership %>% 
  # new column of 1s
  mutate(ownership = rep(1, length(lpnf_ownership$OWN_LEVEL))) %>% 
  # remove original ownership level column
  dplyr::select(-OWN_LEVEL)

#rasterize lpnf_ownership
ownership_rasterize<- st_rasterize(lpnf_ownership_mask1, 
                                   template = temp_rast) # align=TRUE supposed to not keep template values but not working
# align error: "Error in rep_len(x, prod(dim)) : invalid 'length.out' value"

ownership_rast <- rast(ownership_rasterize)
## From stackoverflow: "if `template` is a `stars` object, non-NA cells that are not covered by `sf` receive the value in `template`; see also argument `align`."

# now the raster has values between 0 and 1, but I want only 0 and 1
plot(ownership_rast)

## After reading and plotting different things, it looks like any area in the template that the land ownership DIDN'T cover was kept as the value in the template raster. So I am going to try to replace any values that don't equal 1 to 0

ownership_rast[ownership_rast<1] <- 0

plot(ownership_rast)
```

# Set everything to same resolution, extent, and CRS

CRS: EPSG 4326

```{r}
# this are the resolution, extent, and crs we want from the template
res(temp_rast2) # 0.008333333 0.008333333
ext(temp_rast2) # -121.921574664303, -118.696574664303, 34.3630771668103, 36.4380771668103 (xmin, xmax, ymin, ymax)
crs(temp_rast2) # 4326
```


## Initial Check


### CRS
```{r}
# canopy cover
print("Does canopy_rescaled have correct CRS?")
st_crs(canopy_rescaled) == st_crs(temp_rast2)

# slope
print("Does slope_rescaled have correct CRS?")
st_crs(slope_rescaled) == st_crs(temp_rast2)

# distance from trails
print("Does distance_trails_rescaled have correct CRS?")
#st_crs(canopy_rescaled) == st_crs(temp_rast2)

# distance from roads
print("Does distance_raods_rescaled have correct CRS?")
#st_crs(canopy_rescaled) == st_crs(temp_rast2)

# land ownership
print("Does ownership_rast have correct CRS?")
st_crs(ownership_rast) == st_crs(temp_rast2)
```

#### Reproject
```{r}
slope_rescaled <- project(slope_rescaled,
                          crs(temp_rast2))
# verify
print("Does slope_rescaled have correct CRS?")
st_crs(slope_rescaled) == st_crs(temp_rast2)
```

### Resolution
```{r}
# canopy
print("Does canopy_rescaled have the correct resolution?")
res(canopy_rescaled) == res(temp_rast2)

# slope
print("Does slope_rescaled have the correct resolution?")
res(slope_rescaled) == res(temp_rast2)

# distance from trails
print("Does canopy_rescaled have the correct resolution?")
#res(canopy_rescaled) == res(temp_rast2)

# distance from roads
print("Does canopy_rescaled have the correct resolution?")
#res(canopy_rescaled) == res(temp_rast2)

# land ownership
print("Does ownership_rast have the correct resolution?")
res(ownership_rast) == res(temp_rast2)
```
#### Update any resolutions
```{r}
res(canopy_rescaled)
res(temp_rast2)

```


### Extent
```{r}
# canopy 
print("Does canpy_rescaled have the correct extent?")
ext(canopy_rescaled) == ext(temp_rast2)

# slope 
print("Does canpy_rescaled have the correct extent?")
ext(slope_rescaled) == ext(temp_rast2)

# distance from trails 
print("Does canpy_rescaled have the correct extent?")
#ext(canopy_rescaled) == ext(temp_rast2)

# distance from roads 
print("Does canpy_rescaled have the correct extent?")
#ext(canopy_rescaled) == ext(temp_rast2)

# land ownership 
print("Does ownership_rast have the correct extent?")
ext(ownership_rast) == ext(temp_rast2)
```

```{r}
# need to look closely at these plots, slope looks more zoomed out than template even when same crs and extent
plot(temp_rast2)
plot(canopy_rescaled)
plot(slope_rescaled)
```

